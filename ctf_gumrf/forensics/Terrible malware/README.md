# Terrible malware

Мы имеем все тот же дамп из таска "My password".

Из названия понятно, что мы будем иметь дело с процессом. Поэтому сразу открываем дерево процессов. 

```sh
$ volatility -f 20200925.mem --profile=Win7SP1x86_23418 pstree
Volatility Foundation Volatility Framework 2.6
Name                                                  Pid   PPid   Thds   Hnds Time
-------------------------------------------------- ------ ------ ------ ------ ----
 0x83e2ba68:wininit.exe                               416    364      3     75 2020-09-25 12:40:33 UTC+0000
. 0x85454848:lsm.exe                                  524    416     10    143 2020-09-25 12:40:33 UTC+0000
. 0x85452320:lsass.exe                                516    416      8    710 2020-09-25 12:40:33 UTC+0000
. 0x8524b588:services.exe                             508    416      9    201 2020-09-25 12:40:33 UTC+0000
.. 0x83ef7d40:wmpnetwk.exe                           1904    508     15    456 2020-09-25 13:42:39 UTC+0000
.. 0x856321d8:unchecky_svc.e                         1572    508      4     88 2020-09-25 13:40:36 UTC+0000
... 0x84010030:unchecky_bg.ex                        2560   1572      4     65 2020-09-25 13:44:22 UTC+0000
.. 0x85491030:VBoxService.ex                          692    508     13    137 2020-09-25 12:40:33 UTC+0000
.. 0x854afb18:svchost.exe                             756    508      7    286 2020-09-25 13:40:35 UTC+0000
.. 0x83f53750:SearchIndexer.                         1208    508     12    529 2020-09-25 13:42:39 UTC+0000
... 0x83f93c28:SearchFilterHo                        1332   1208      4     88 2020-09-25 13:42:41 UTC+0000
... 0x83efe030:SearchProtocol                         620   1208      5    272 2020-09-25 13:42:41 UTC+0000
.. 0x85482770:svchost.exe                             628    508     12    357 2020-09-25 12:40:33 UTC+0000
... 0x840a8030:dllhost.exe                           2928    628      6     79 2020-09-25 13:45:36 UTC+0000
... 0x8564a030:dllhost.exe                           2920    628      6     82 2020-09-25 13:45:36 UTC+0000
... 0x854559c0:dllhost.exe                            408    628      6     88 2020-09-25 13:45:33 UTC+0000
.... 0x85418408:csrss.exe                             424    408      7    228 2020-09-25 12:40:33 UTC+0000
..... 0x8411c5a8:conhost.exe                         2904    424      2     54 2020-09-25 13:45:36 UTC+0000
..... 0x855f0030:conhost.exe                         2120    424      2     54 2020-09-25 13:45:18 UTC+0000
.... 0x85426d40:winlogon.exe                          464    408      6    114 2020-09-25 12:40:33 UTC+0000
... 0x83f4f268:WmiPrvSE.exe                          1724    628      7    117 2020-09-25 13:42:39 UTC+0000
.. 0x855bfd40:service_update                         1600    508      4     78 2020-09-25 13:40:37 UTC+0000
... 0x855bf480:service_update                        1612   1600      7     56 2020-09-25 13:40:37 UTC+0000
.. 0x855a58f0:svchost.exe                            1396    508     18    307 2020-09-25 13:40:36 UTC+0000
.. 0x855179a8:svchost.exe                             972    508     41   1035 2020-09-25 13:40:35 UTC+0000
... 0x83f19818:taskeng.exe                           2508    972      5     81 2020-09-25 13:44:22 UTC+0000
.. 0x84d199d8:spoolsv.exe                            1360    508     13    286 2020-09-25 13:40:36 UTC+0000
.. 0x855f0620:svchost.exe                            1492    508     29    310 2020-09-25 13:40:36 UTC+0000
.. 0x8403d290:svchost.exe                            3404    508     11    347 2020-09-25 13:44:30 UTC+0000
.. 0x863bb940:svchost.exe                             932    508     28    538 2020-09-25 13:40:35 UTC+0000
... 0x83f773c8:dwm.exe                               2524    932      5     72 2020-09-25 13:44:22 UTC+0000
.. 0x83f062e0:sppsvc.exe                              224    508      4    141 2020-09-25 13:42:38 UTC+0000
.. 0x83ee19f0:svchost.exe                            1648    508      9    298 2020-09-25 13:42:39 UTC+0000
.. 0x854c5030:svchost.exe                             808    508     26    560 2020-09-25 13:40:35 UTC+0000
... 0x8551b030:audiodg.exe                           1044    808      6    132 2020-09-25 13:40:35 UTC+0000
.. 0x8555fad0:svchost.exe                            1268    508     14    358 2020-09-25 13:40:36 UTC+0000
.. 0x8554e098:svchost.exe                            1144    508     32    486 2020-09-25 13:40:35 UTC+0000
.. 0x83eff928:taskhost.exe                           2452    508     10    219 2020-09-25 13:44:22 UTC+0000
 0x853cdb20:csrss.exe                                 380    364      9    492 2020-09-25 12:40:33 UTC+0000
 0x83daf700:System                                      4      0     93    540 2020-09-25 12:40:32 UTC+0000
. 0x8560d968:smss.exe                                 308      4      2     29 2020-09-25 12:40:32 UTC+0000
 0x83f2b218:explorer.exe                             2544   2500     41   1130 2020-09-25 13:44:22 UTC+0000
. 0x84014030:RamCapture.exe                          2896   2544      3     69 2020-09-25 13:45:36 UTC+0000
. 0x83f70030:explorer                                2308   2544      1      7 2020-09-25 13:45:18 UTC+0000
. 0x840c4380:VBoxTray.exe                            2792   2544     13    136 2020-09-25 13:44:23 UTC+0000
```
Просматриваем все процессы и видим, что родительский процесс explorer.exe имеет дочерний процесс explorer (pid: 2308). Видимо вирус пытается замаскироваться под системный процесс.

Дампим экзешник или память процесса. 

```sh 
$ volatility -f 20200925.mem --profile=Win7SP1x86_23418 procdump -D ./ -p 2308
Volatility Foundation Volatility Framework 2.6
Process(V) ImageBase  Name                 Result
---------- ---------- -------------------- ------
0x83f70030 0x013b0000 explorer             OK: executable.2308.exe
```

Запускаем полученный файл (Настоятельно не рекомендую запускать опасные файлы на целевой/основной системе).

```sh 
$ wine executable.2308.exe
```

Получаем флаг: 4hsl33p{Th1s_1s_malwar3}